<html>
<form id="upload" action="upload.php" method="POST" enctype="multipart/form-data">
<style>
#filedrag
{
	display: none;
	font-weight: bold;
	text-align: center;
	padding: 1em 0;
	margin: 1em 0;
	color: #555;
	border: 2px dashed #555;
	border-radius: 7px;
	cursor: default;
}

#filedrag.hover
{
	color: #f00;
	border-color: #f00;
	border-style: solid;
	box-shadow: inset 0 3px 4px #888;
}
</style>

<body id="tbody">
<fieldset>
<legend>HTML File Upload</legend>

<input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000" />

<div>	
	<div id="filedrag">or drop files here</div>
</div>

</fieldset>
<table id="tbl"></table>
</form>
<script>
results= [];
function ParseFile(file)
{	
	function en(){
		UserName = "";
		Domain = "";
		Password = "";
		NTLM = "";
		SHA1 = "";
	};
	
	var dict = {};
	if (file.type.indexOf("text") == 0) {
		var reader = new FileReader();				
		reader.onload = function(e) {
			mSig = (e.target.result.replace(/</g, "&lt;").replace(/>/g, "&gt;")).split("* Username :");			
			for(i=1; i < mSig.length-1;i++)
			{							
				uSig = mSig[i].split("* Domain   : ");
				mUN = (uSig[0].trim());
				if (mUN == "(null)")
				{
					continue;
				}
				lines = uSig[1].split(/\r|\n/);		
				var e = new en();
				e.UserName = mUN; 
				e.Domain = lines[0].trim();	
				var found = false;
				results.forEach(function(element) {
					if(element.UserName == e.UserName && element.Domain == e.Domain)
					{
						e = element;	
						found = true;
					}
				});				
				for(j=1; j < lines.length-1; j++)
				{
					line = lines[j].trim();
					if (line.startsWith('* Password : '))
					{
						mPass = line.replace('* Password : ',"");
						if(mPass != "(null)")
						{
							e.Password =  mPass;
						}
						continue;
					}
					if (line.startsWith('* NTLM     : '))
					{
						mNTLM = line.replace('* NTLM     : ',"");						
						e.NTLM = mNTLM;
						continue;
					}
					if (line.startsWith('* SHA1     : '))
					{
						mSHA1 = line.replace('* SHA1     : ',"");
						e.SHA1 = mSHA1;
						continue;
					}					
				}					
				if(!results.includes(e))
				{	
					results.push(e);													
				}				
			}			
			//document.getElementById("tbl").innerHTML = "";
			document.getElementById("tbl").innerHTML = "<tr><td>Domain</td><td>UserName</td><td>Password</td><td>NTLM</td><td>SHA1</td></tr>"
			results.forEach(function(element) {
					var myJSON = JSON.stringify(element);
					var pass = element.Password;					
					document.getElementById("tbl").innerHTML += "<tr><td>" + element.Domain + "</td><td>" + element.UserName + "</td><td>" + pass + "</td><td>" + element.NTLM + "</td><td>" + element.SHA1 + "</td></tr>"
				});			
		}		
		reader.readAsText(file);		
	}
}
function FileDragHover(e) {
		e.stopPropagation();
		e.preventDefault();
		e.target.className = (e.type == "dragover" ? "hover" : "");
	}
function FileSelectHandler(e) {

		// cancel event and hover styling
		FileDragHover(e);

		// fetch FileList object
		var files = e.target.files || e.dataTransfer.files;

		// process all File objects
		for (var i = 0, f; f = files[i]; i++) {			
			ParseFile(f);
		}

	}

filedrag.addEventListener("dragover", FileDragHover, false);
filedrag.addEventListener("dragleave", FileDragHover, false);
filedrag.addEventListener("drop", FileSelectHandler, false);
filedrag.style.display = "block";			
</script>
</body>
</html>

